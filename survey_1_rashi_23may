# Today we will use data cleaned by chiara to see what we want to do 

data2 <- read.csv("/Users/rashisingh/Thesis_Fertility_Intentions/Survey_1_Rashi.csv")

climateconcern2 <- data2[, c("q41_t0", "q43_t1")]
ideal_children_society2 <- data2[, c("q50_t0_mod", "q52_mod_t1")]
ideal_children_personally2 <- data2[, c("q51_t0", "q53_mod_t1")]

#Combining Columns of T0 & T1 

data2$concern_combined2 <- paste(data2$q41_t0, data2$q43_t1)
data2$ideal_children_society2 <- paste(data2$q50_t0_mod, data2$q52_mod_t1)
data2$ideal_children_personally2 <- paste(data2$q51_t0, data2$q53_mod_t1)
sum(is.na(data2$concern_combined2)) # 0
sum(is.na(data2$ideal_children_society2)) #0
sum(is.na(data2$ideal_children_personally2)) #0

typeof(data2$numeric_birth_year) #integer

range(data2$numeric_birth_year, na.rm = TRUE) # 1933 2008
data2$age <- 2025 - data2$numeric_birth_year
print(data2$age)

mean(data2$age, na.rm = TRUE)

# Choosing respondants who are in reproductive age (18-50)
reproductive_age_2 <- data2[data2$age >= 18 & data2$age <= 50, ]
reproductive_age_2$age

sum(is.na(reproductive_age_2$age)) #17

#Categorising data for plotting 

reproductive_age_2 <- reproductive_age_2 %>%
    mutate(concern_category = case_when(
        str_detect(concern_combined2, "not at all concerned|unconcerned") ~ "UNCONCERNED",
        str_detect(concern_combined2, "fairly concerned") ~ "CONCERNED",
        str_detect(concern_combined2, "very concerned") ~ "VERY CONCERNED",
        str_detect(concern_combined2, "extremely concerned") ~ "EXTREMELY CONCERNED",
        TRUE ~ NA_character_
    ))

sum(is.na(reproductive_age_2$concern_category)) #17

# dropping NA 
reproductive_age_2 <- reproductive_age_2 %>%
    filter(!is.na(concern_category))


 # Calculate the count and percentage for each category
category_counts <- reproductive_age_2 %>%
    count(concern_category) %>%
    mutate(percentage = n / sum(n) * 100)

print(category_counts)

# Plotting respondents from reproductive age category for concern_category
category_counts$concern_category <- factor(
    category_counts$concern_category,
    levels = c("UNCONCERNED", "CONCERNED", "VERY CONCERNED", "EXTREMELY CONCERNED")
)

ggplot(category_counts, aes(x = concern_category, y = percentage, fill = concern_category)) +
    geom_bar(stat = "identity", width = 0.6, color = "white") +
    geom_text(aes(label = paste0(round(percentage, 1), "%")),
              hjust = -0.1, size = 4.5, fontface = "bold") +
    scale_fill_brewer(palette = "Pastel1") +
    labs(
        title = "Distribution of Climate Change Concern Among Respondents",
        x = "Concern Category",
        y = "Percentage of Respondents"
    ) +
    theme_minimal(base_size = 13) +
    theme(
        plot.title = element_text(hjust = 0.5, face = "bold"),
        axis.text.x = element_text(size = 11),
        axis.text.y = element_text(size = 11),
        legend.position = "none"
    ) +
    coord_flip() +
    ylim(0, max(category_counts$percentage) + 10)

ggsave("climate_concern_survey2_rashi.png", width = 10, height = 6, dpi = 300, bg = "white")

# For descriptive statistics

count(reproductive_age_2, concern_category)
count(reproductive_age_2, sex)
count(reproductive_age_2, numeric_number_children)
count(reproductive_age_2, education)
count(reproductive_age_2, employment_status)
count(reproductive_age_2, net_income_month)
count(reproductive_age_2, mar_status)
count(reproductive_age_2, age)

